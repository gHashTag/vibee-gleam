# Lead Management System

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL (Neon)
- **URL**: `postgresql://neondb_owner:REDACTED_DB_PASSWORD@ep-bitter-frog-a1bewei7-pooler.ap-southeast-1.aws.neon.tech/neondb`
- **Schema**: `schema.sql` - –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –ª–∏–¥–æ–≤

### 2. –¢–∞–±–ª–∏—Ü—ã

#### `leads` - –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–æ–≤
```sql
- id (BIGSERIAL PRIMARY KEY)
- telegram_user_id (BIGINT) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
- username, first_name, last_name, phone
- first_message - –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- source_chat_id, source_chat_name - –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª
- status - new/contacted/qualified/converted/lost
- priority - low/medium/high/urgent
- intent - buy/sell/exchange/info
- crypto_interest[] - –º–∞—Å—Å–∏–≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
- trigger_words[] - —Å—Ä–∞–±–æ—Ç–∞–≤—à–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
- agent_response - –æ—Ç–≤–µ—Ç –∞–≥–µ–Ω—Ç–∞
- total_messages - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- last_activity - –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
```

#### `lead_messages` - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
```sql
- lead_id - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ª–∏–¥
- message_text - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- direction - incoming/outgoing
- contains_question - —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–æ–ø—Ä–æ—Å?
- contains_urgency - —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ä–æ—á–Ω–æ—Å—Ç—å?
```

#### `lead_actions` - –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π
```sql
- lead_id
- action_type - message_sent/forwarded/status_changed
- action_data - JSON —Å –¥–µ—Ç–∞–ª—è–º–∏
```

#### `lead_notes` - –ó–∞–º–µ—Ç–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
```sql
- lead_id
- note - —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏
- note_type - general/important/follow_up
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ª–∏–¥–æ–≤

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è (Intent)
- **buy** - –∫—É–ø–ª—é, –∫—É–ø–∏—Ç—å, —Ö–æ—á—É –∫—É–ø–∏—Ç—å
- **sell** - –ø—Ä–æ–¥–∞–º, –ø—Ä–æ–¥–∞—Ç—å
- **exchange** - –æ–±–º–µ–Ω, –æ–±–º–µ–Ω—è—Ç—å, –ø2–ø
- **info** - –æ—Å—Ç–∞–ª—å–Ω–æ–µ

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
- **Bitcoin** - –±–∏—Ç–∫–æ–∏–Ω, bitcoin, btc
- **USDT** - usdt, —Ç–µ–∑–µ—Ä, tether
- **Ethereum** - —ç—Ñ–∏—Ä, ethereum, eth

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- **urgent** üî¥ - —Å—Ä–æ—á–Ω–æ, –±—ã—Å—Ç—Ä–æ, —Å–µ–π—á–∞—Å
- **high** üü† - –º–Ω–æ–≥–æ, –±–æ–ª—å—à—É—é —Å—É–º–º—É
- **medium** üü° - –æ—Å—Ç–∞–ª—å–Ω–æ–µ

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–¥–æ–≤

**–§–∞–π–ª**: `gleam/src/vibee/leads/lead_logger.gleam`

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –ª–∏–¥–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è:

```
============================================================
üî• –ù–û–í–´–ô –õ–ò–î –°–û–•–†–ê–ù–Å–ù
============================================================

üì± –ö–û–ù–¢–ê–ö–¢–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
  Telegram ID: 123456789
  Username: @user
  –ò–º—è: –ò–≤–∞–Ω
  –§–∞–º–∏–ª–∏—è: –ü–µ—Ç—Ä–æ–≤

üí¨ –ü–ï–†–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï:
  –∫—É–ø–ª—é –±–∏—Ç–∫–æ–∏–Ω —Å—Ä–æ—á–Ω–æ

üìä –ê–ù–ê–õ–ò–ó:
  –ù–∞–º–µ—Ä–µ–Ω–∏–µ: –ü–æ–∫—É–ø–∫–∞
  –ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç: Bitcoin
  –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –°—Ä–æ—á–Ω—ã–π

üéØ –¢–†–ò–ì–ì–ï–†–´:
  ‚Ä¢ –∫—É–ø–ª—é –±–∏—Ç–∫–æ–∏–Ω

‚úÖ –û–¢–í–ï–¢ –ê–ì–ï–ù–¢–ê:
  –ü—Ä–∏–≤–µ—Ç! –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –ø–æ–∫—É–ø–∫–æ–π. –ü–∏—à–∏ –≤ –ª–∏—á–∫—É, –≤—Å—ë —Ä–∞—Å—Å–∫–∞–∂—É.

üìç –ò–°–¢–û–ß–ù–ò–ö:
  –ß–∞—Ç: Aimly.io dev
  ID: -5082217642

============================================================
```

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Flow

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä**
   ```
   –∫—É–ø–ª—é –±–∏—Ç–∫–æ–∏–Ω
   ```

2. **–ê–≥–µ–Ω—Ç –¥–µ—Ç–µ–∫—Ç–∏—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç**
   ```
   –ü—Ä–∏–≤–µ—Ç! –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –ø–æ–∫—É–ø–∫–æ–π. –ü–∏—à–∏ –≤ –ª–∏—á–∫—É.
   ```

3. **–î–∏–∞–ª–æ–≥ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è –≤ Lead –≥—Ä—É–ø–ø—É**
   ```
   üî• –ù–û–í–´–ô –õ–ò–î

   üë§ –ö–ª–∏–µ–Ω—Ç: User
   üí¨ –í–æ–ø—Ä–æ—Å: –∫—É–ø–ª—é –±–∏—Ç–∫–æ–∏–Ω
   ...
   ```

4. **–õ–∏–¥ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å**
   ```
   [LEAD] üíæ Lead would be saved here
   ```

5. **TODO: –õ–∏–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ PostgreSQL**
   - –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ
   - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ê–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏–π
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç

## üîß Setup PostgreSQL

### 1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ
psql 'postgresql://neondb_owner:REDACTED_DB_PASSWORD@ep-bitter-frog-a1bewei7-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require'

# –í—ã–ø–æ–ª–Ω–∏—Ç—å schema.sql
\i schema.sql
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
\dt

-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã leads
\d leads

-- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–∏–¥–æ–≤
SELECT * FROM active_leads;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT * FROM lead_stats;
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –≤ .env

```bash
DATABASE_URL=postgresql://neondb_owner:REDACTED_DB_PASSWORD@ep-bitter-frog-a1bewei7-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require
```

## üìà Queries –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### –ê–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–¥—ã

```sql
SELECT 
    telegram_user_id,
    full_name,
    first_message,
    status,
    priority,
    intent,
    crypto_interest,
    total_messages,
    last_activity
FROM active_leads
ORDER BY priority DESC, last_activity DESC
LIMIT 20;
```

### –õ–∏–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è

```sql
SELECT 
    COUNT(*) as total,
    COUNT(CASE WHEN status = 'new' THEN 1 END) as new,
    COUNT(CASE WHEN priority = 'urgent' THEN 1 END) as urgent
FROM leads
WHERE created_at >= CURRENT_DATE;
```

### –¢–æ–ø –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç

```sql
SELECT 
    UNNEST(crypto_interest) as crypto,
    COUNT(*) as count
FROM leads
GROUP BY crypto
ORDER BY count DESC;
```

### –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º

```sql
SELECT 
    status,
    COUNT(*) as count,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percentage
FROM leads
GROUP BY status
ORDER BY count DESC;
```

## üöÄ TODO: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### Phase 1: –ë–∞–∑–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚úÖ
- [x] Schema —Å–æ–∑–¥–∞–Ω–∞
- [x] Lead logger —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –ê–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

### Phase 2: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL —á–µ—Ä–µ–∑ pog
- [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ username –∏–∑ Telegram API
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

### Phase 3: Dashboard
- [ ] Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–∏–¥–æ–≤
- [ ] –§–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV/Excel
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö

### Phase 4: CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] Webhook –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö CRM
- [ ] API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–∏–¥–æ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- [ ] Scoring –ª–∏–¥–æ–≤

## üìû –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–∏–¥–æ–≤ –≤ –ª–æ–≥–∞—Ö

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
cd /workspaces/vibee-gleam/gleam
export $(cat .env | xargs)
gleam run | grep "–ù–û–í–´–ô –õ–ò–î" -A 30

# –ù–∞ Fly.io
fly logs --app vibee-mcp | grep "–ù–û–í–´–ô –õ–ò–î" -A 30
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
psql 'postgresql://neondb_owner:REDACTED_DB_PASSWORD@ep-bitter-frog-a1bewei7-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require'

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–∏–¥—ã
SELECT * FROM active_leads;
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏

### –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

1. **–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**
   - Telegram ID (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - Username (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ò–º—è/–§–∞–º–∏–ª–∏—è
   - –¢–µ–ª–µ—Ñ–æ–Ω (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω)

2. **–ü–æ–≤–µ–¥–µ–Ω–∏–µ**
   - –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –∞–≥–µ–Ω—Ç–∞
   - –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

3. **–ù–∞–º–µ—Ä–µ–Ω–∏—è**
   - –ß—Ç–æ —Ö–æ—á–µ—Ç (buy/sell/exchange)
   - –ö–∞–∫–∞—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (urgent/high/medium)

4. **–ò—Å—Ç–æ—á–Ω–∏–∫**
   - –ò–∑ –∫–∞–∫–æ–≥–æ —á–∞—Ç–∞
   - –ö–∞–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Å—Ä–∞–±–æ—Ç–∞–ª–∏
   - –û—Ç–≤–µ—Ç –∞–≥–µ–Ω—Ç–∞

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–µ–≥–æ–¥–Ω—è**
   - [x] Schema —Å–æ–∑–¥–∞–Ω–∞
   - [x] Lead logger —Ä–∞–±–æ—Ç–∞–µ—Ç
   - [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ Neon

2. **–≠—Ç–∞ –Ω–µ–¥–µ–ª—è**
   - [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å pog –¥–ª—è PostgreSQL
   - [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–∏–¥—ã –≤ –±–∞–∑—É
   - [ ] Dashboard –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

3. **–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü**
   - [ ] CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
   - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π scoring
   - [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º

---

**Status**: Schema ready, logging implemented, PostgreSQL integration pending
**Last Updated**: 2025-12-18 05:18 UTC
